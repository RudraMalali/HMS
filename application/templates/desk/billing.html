{% extends 'layout.html' %}

{% block title %}
    Desk - Billing
{% endblock %}

{% block content%}
{% include "desk/includes/navbar.html" %}
<style>
    table {
      width:100%;
    }
    table, th, td {
      border: 1px solid rgb(92, 90, 90);
      border-collapse: collapse;
    }
    th, td {
      padding: 15px;
      text-align: left;
    }
    #t01 tr:nth-child(even) {
      background-color: #eee;
    }
    #t01 tr:nth-child(odd) {
     background-color: #fff;
    }
    #t01 th {
      background-color: grey;
      color: black;
    }
</style>
<main class="my-form">
    <div class="cotainer">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <br>
                    <div class="card">
                        <div class="card-header text-center"><strong>Billing</strong></div>
                        <div class="card-body ">
                            <form name="patient bill" action="{{url_for('billpatient')}}" method="POST">
                                <div class="text-center">
                                    <label for="patid">Patient ID: </label>
                                    <div class="text-center">
                                        {{form.pid}}
                                    </div>
                                </div class="text-center" >
                                <div class="text-center">
                                    <button type="submit" name="action" value="show" class="btn btn-primary btn-lg" formmethod="POST" >
                                    Show
                                    </button>
                            </div>

                            <br>
                            
                                
                                    {% with messages = get_flashed_messages() %}
                                      {% if messages %}
                                      <div class="alert alert-info text-center">
                                          <ul class=flashes>
                                          {% for message in messages %}
                                          <li>{{ message }}</li>
                                          {% endfor %}
                                          </ul>
                                        </div>
                                      {% endif %}
                                      {% endwith %}
                                
                                  
                            </form>
                        </div>
                        
                    </div>
                    {% if rudtest %}
                    
                        <center><h2><u>Patient Details</u></h2></center>
                        <table id="t01">
                            <thead>
                                <tr>
                                    <th>Patient ID</th>
                                    <th>Name</th> 
                                    <th>Age</th>
                                    <th>Address</th> 
                                    <th>DOJ</th>
                                    <th>DOD</th>
                                    <th>Type of room</th> 
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in rudtest %}
                                    <tr>
                                        <td>{{row[1]}}</td>
                                        <td>{{row[2]}}</td>
                                        <td>{{row[3]}}</td>
                                        <td>{{row[6]}}</td>
                                        <td>{{row[4]}}</td>
                                        <td>{{session['dod']}}</td>
                                        <td>{{row[5]}}</td>
                                    </tr>
                                    {% endfor %}
                            </tbody>
                        </table>
                        <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
                            <label>No. of days:</label>&nbsp;
                            <label>{{session['doa']}}</label>&nbsp;&nbsp;&nbsp;
                            <label>Room Bill:</label>&nbsp;
                            <label>{{session['roomcharge']}}</label>
                        </div>
                        
                        {% endif %}
                        {% if rdata %}
                        <br><br>
                        <center><h2><u>Pharmacy Charges</u></h2></center>
                        <table id="t02">
                            <thead>
                                <tr>
                                    <th>Medicine</th>
                                    <th>Quantity</th> 
                                    <th>Rate</th>
                                    <th>Amount</th>  
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in rdata %}
                                 
                                    <tr>
                                        <td>{{r[0]}}</td>
                                        <td>{{r[1]}}</td>
                                        <td>{{r[2]}}</td>
                                        <td>{{ r[1] | int() * r[2] | int()}}</td>
                                    </tr>
                                    {% endfor %}    
                            </tbody>
                        </table>
                        <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
                            <label>Pharmacy Bill:</label>&nbsp;
                            <label>{{session['pharmtotal']}}</label>
                        </div>
                        
                        
                        
                        
                        {% endif %}
                        {% if ddata %}
                        <br><br>
                        <center><h2><u>Diagnostic Charges</u></h2></center>
                        <table id="t03">
                            <thead>
                                <tr>
                                    <th>Test</th>
                                    <th>Amount</th>  
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in ddata %}
                                    <tr>
                                        <td>{{r[0]}}</td>
                                        <td>{{r[1]}}</td>
                                    </tr>
                                    {% endfor %}  
                            </tbody>
                        </table>
                        <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
                            <label>Diagnostic Bill:</label>&nbsp;
                            <label>{{session['diagnostictotal']}}</label>
                        </div>
                        
                        {% endif %}
                        
                        
                        {% for row in rudtest %}
                        <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
                            <label>Total Bill:</label>&nbsp;&nbsp;
                            <label>{{session['roomcharge']+session['pharmtotal']+session['diagnostictotal']}}</label>
                        </div>

                        {% endfor %}
                        
                    <br>

            </div>
        </div>
    </div>

</main>

{% endblock%}
